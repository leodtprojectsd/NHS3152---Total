<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NHS31xx SW API: bussync: Bus Synchronization driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nxp-logo_small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NHS31xx SW API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a00432.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">bussync: Bus Synchronization driver<div class="ingroups"><a class="el" href="a00427.html">Drivers</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The Bus Synchronization driver (BusSync) provides the API to safely and reliably access registers of "slow blocks", i.e. hardware blocks that run on a slower clock than the APB Bus.</p>
<dl class="section user"><dt>Problem description:</dt><dd>The peripheral registers (which are the interface to access the chip peripherals) are accessed through the APB Bus which is clocked at System Clock frequency. Most of the HW blocks are clocked by the same System Clock (or derivatives), however there are some HW blocks that have a clock with a significantly lower frequency. Typically these blocks are the ones that are active during a deep power down (e.g. the PMU and RTC). For these slow blocks, synchronization between the registers (which are accessed through the APB Bus at System Clock frequency) and the HW block internal logic is needed.</dd></dl>
<dl class="section user"><dt>Synchronization Mechanism:</dt><dd>The synchronization mechanism consists of having periods where the high frequency domain (APB Bus) waits for the low frequency domain (peripheral block) to complete the register access. These synchronization waits are controlled by the signal of a synchronization register (ACCSTAT) that each slow HW block provides.<ul>
<li>Register read procedure:<ol type="1">
<li>Trigger the HW block for a register read</li>
<li>Perform the synchronization wait</li>
<li>Read the content of the register</li>
</ol>
</li>
<li>Register write procedure:<ol type="1">
<li>Trigger the HW block for a register write</li>
<li>Perform the synchronization wait</li>
<li>The new register content is now assimilated by the HW block</li>
</ol>
</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Preemption problem:</dt><dd>It is possible that a given synchronized read or write procedure is preempted by a read or write to the same hardware block in an ISR or higher priority thread. This could result in incorrect synchronization waits which could lead to unreliable read or write procedures. To ensure correct synchronization, even when preempted, this driver must be passed an additional parameter referred to as "access counter".</dd></dl>
<dl class="section user"><dt>Usage:</dt><dd>Safe and reliable reading and writing from/to synchronized registers can be done using, respectively, the <a class="el" href="a00432.html#ga461b7ed1ec1d65a67ef80d761cb8afac">Chip_BusSync_ReadReg</a> and <a class="el" href="a00432.html#ga6ea6c8e55a9af921ac4c729bbdc5a8f1">Chip_BusSync_WriteReg</a> functions. In addition to the target register address, these functions also receive the address of the synchronization register ("ACCSTAT") as well as the address of the access counter. Each slow HW block must declare its own access counter: a volatile integer, which does not need an initial value.</dd></dl>
<dl class="section user"><dt>Example - Synchronized RTC register read and write:</dt><dd><div class="fragment"><div class="line">    <span class="comment">/* The access counter to be used by BusSync for synchronizing access to RTC - since RTC is a slow HW block. */</span></div><div class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keywordtype">int</span> sAccessCounter = 0;</div><div class="line">    <a class="code" href="a00432.html#ga6ea6c8e55a9af921ac4c729bbdc5a8f1">Chip_BusSync_WriteReg</a>(&amp;<a class="code" href="a00433.html#ga0ac2db8886b6fc2962d0919d77089bb7">NSS_RTC</a>-&gt;ACCSTAT, &amp;sAccessCounter, &amp;<a class="code" href="a00433.html#ga0ac2db8886b6fc2962d0919d77089bb7">NSS_RTC</a>-&gt;CR, 0);</div><div class="line">    uint32_t value = <a class="code" href="a00432.html#ga461b7ed1ec1d65a67ef80d761cb8afac">Chip_BusSync_ReadReg</a>(&amp;<a class="code" href="a00433.html#ga0ac2db8886b6fc2962d0919d77089bb7">NSS_RTC</a>-&gt;ACCSTAT, &amp;sAccessCounter, &amp;<a class="code" href="a00433.html#ga0ac2db8886b6fc2962d0919d77089bb7">NSS_RTC</a>-&gt;SR);</div></div><!-- fragment --> </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The syncing process, and thus a register read or write, takes time. The synchronization procedure has a worst-case delay of 3 slow clock cycles. For a slow clock of 32kHz, the worst case delay is nearly 100us (3 * 1/32k). Also note that if such a read or write is used in an ISR, the interrupt latency for all lower priority interrupts increases. At 8MHz, the 100us boils down to an increased latency of 800 cpu ticks. </dd></dl>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga6ea6c8e55a9af921ac4c729bbdc5a8f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00432.html#ga6ea6c8e55a9af921ac4c729bbdc5a8f1">Chip_BusSync_WriteReg</a> (volatile const uint32_t *pACCSTAT, volatile int *pAccessCounter, <a class="el" href="a00437.html#gaec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t *pReg, uint32_t value)</td></tr>
<tr class="separator:ga6ea6c8e55a9af921ac4c729bbdc5a8f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga461b7ed1ec1d65a67ef80d761cb8afac"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00432.html#ga461b7ed1ec1d65a67ef80d761cb8afac">Chip_BusSync_ReadReg</a> (volatile const uint32_t *pACCSTAT, volatile int *pAccessCounter, <a class="el" href="a00437.html#gaf63697ed9952cc71e1225efe205f6cd3">__I</a> uint32_t *pReg)</td></tr>
<tr class="separator:ga461b7ed1ec1d65a67ef80d761cb8afac"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga6ea6c8e55a9af921ac4c729bbdc5a8f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6ea6c8e55a9af921ac4c729bbdc5a8f1">&#9670;&nbsp;</a></span>Chip_BusSync_WriteReg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Chip_BusSync_WriteReg </td>
          <td>(</td>
          <td class="paramtype">volatile const uint32_t *&#160;</td>
          <td class="paramname"><em>pACCSTAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile int *&#160;</td>
          <td class="paramname"><em>pAccessCounter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00437.html#gaec43007d9998a0a0e01faede4133d6be">__IO</a> uint32_t *&#160;</td>
          <td class="paramname"><em>pReg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Write a value into a register of a slow HW block </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pACCSTAT</td><td>: pointer to the synchronization register (e.g. ACCSTAT) of the HW block whose register to write to </td></tr>
    <tr><td class="paramname">pAccessCounter</td><td>: pointer to the access counter declared for the HW block whose register to write to </td></tr>
    <tr><td class="paramname">pReg</td><td>: pointer to the register to write to </td></tr>
    <tr><td class="paramname">value</td><td>: value to write to the register </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga461b7ed1ec1d65a67ef80d761cb8afac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga461b7ed1ec1d65a67ef80d761cb8afac">&#9670;&nbsp;</a></span>Chip_BusSync_ReadReg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t Chip_BusSync_ReadReg </td>
          <td>(</td>
          <td class="paramtype">volatile const uint32_t *&#160;</td>
          <td class="paramname"><em>pACCSTAT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile int *&#160;</td>
          <td class="paramname"><em>pAccessCounter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00437.html#gaf63697ed9952cc71e1225efe205f6cd3">__I</a> uint32_t *&#160;</td>
          <td class="paramname"><em>pReg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Read a value from a register of a slow HW block </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pACCSTAT</td><td>: pointer to the synchronization register (e.g. ACCSTAT) of the HW block whose register to read from </td></tr>
    <tr><td class="paramname">pAccessCounter</td><td>: pointer to the access counter declared for the HW block whose register to read from </td></tr>
    <tr><td class="paramname">pReg</td><td>: pointer to the register to read from </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>value read from the register </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 20 2020 08:24:34 for NHS31xx SW API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
