<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NHS31xx SW API: batimp: Battery impedance check module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nxp-logo_small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NHS31xx SW API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a00465.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">batimp: Battery impedance check module<div class="ingroups"><a class="el" href="a00425.html">Modules</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The Battery impedance check module provides a single API call to check the battery impedance by checking the voltage drop under different loads.</p>
<dl class="section user"><dt>Operating principle</dt><dd>This module gradually activates extra current consumption in the NHS chip and observes if and when the VBAT voltage drops below 1.8V using the BOD HW block (see <a class="el" href="a00458.html#pmu_brown_out_detector_par">pmu_brown_out_detector_par</a>). <br />
 The amount of extra current needed for VBAT to drop to 1.8V is inversely proportional to the battery impedance.</dd></dl>
<p>The extra current consumption is generated by sequentially activating the current dac of 1 or more of the PIO3, PIO7, PIO10 and PIO11 pins - the 4 high-source pads which have analog high current drive capabilities. See the <a class="el" href="a00456.html#iocon_currentdrive_anchor">iocon_currentdrive_anchor</a> IOCON documentation.</p>
<dl class="section user"><dt>Restrictions</dt><dd><ul>
<li>The pins where the current drive mode will be enabled must be unconnected or pulled low at the time of the battery impedance check, so that no external current is drawn. Only the quiescent current is used to put more load on the battery</li>
<li>It is impossible for the chip to provide an estimate of the battery impedance, or the remaining battery capacity. Instead, it can check whether the current impedance causes a voltage drop to below the BOD detection point, given different loads. It is then up to the higher layers to interpret this and correlate it with information received from your battery supplier.</li>
</ul>
</dd></dl>
<dl class="section user"><dt>Diversity</dt><dd>This module supports diversity settings. It is expected that each application that uses this module includes it and configures the diversity settings of the module according to its specific needs. Check <a class="el" href="a00466.html">Diversity Settings</a> for all diversity parameters.</dd></dl>
<dl class="section user"><dt>Example</dt><dd>In its most effective form, all pins are free to be used by this module, and the battery impedance check can try out all possible combinations. A complete check will take a little over 35 milliseconds.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">// Placed in app_sel.h</span></div><div class="line"><span class="preprocessor">#define BATIMP_WAIT_TIME 1</span></div><div class="line"><span class="preprocessor">#define BATIMP_USE_PIO3 1</span></div><div class="line"><span class="preprocessor">#define BATIMP_USE_PIO7 1</span></div><div class="line"><span class="preprocessor">#define BATIMP_USE_PIO10 1</span></div><div class="line"><span class="preprocessor">#define BATIMP_USE_PIO11 1</span></div></div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">// Placed in main.c</span></div><div class="line"><span class="keywordflow">if</span> (<a class="code" href="a00465.html#gaf009ae3d2d353fbe9e3bac950554449e">BatImp_Check</a>() &lt; 0) {</div><div class="line">    <span class="comment">// Battery can still handle a load of more than 3.3 mA</span></div><div class="line">}</div></div><!-- fragment --> <table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:a00466"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00466.html">Diversity Settings</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaf009ae3d2d353fbe9e3bac950554449e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00465.html#gaf009ae3d2d353fbe9e3bac950554449e">BatImp_Check</a> (void)</td></tr>
<tr class="separator:gaf009ae3d2d353fbe9e3bac950554449e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="gaf009ae3d2d353fbe9e3bac950554449e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf009ae3d2d353fbe9e3bac950554449e">&#9670;&nbsp;</a></span>BatImp_Check()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int BatImp_Check </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Successively applies different settings to the analog current drive mode of the enabled high-source pads. Each iteration increases the load on the battery. When a BOD is detected, the operation stops. The returnvalue then reflects the load which triggered the BOD. During the check the VBAT voltage comparator is disabled to prevent battery disconnection. The original setting is restored at function exit. </p><dl class="section warning"><dt>Warning</dt><dd>This call is run synchronously, and will take a long time to complete. The exact amount depend on the number of pins assigned to this module, the battery impedance and <code>maxCurrent</code> value given, and the BOD detection time as set by <a class="el" href="a00466.html#ga3d0daf5d16bcb1b535a72dee69a2790f">BATIMP_WAIT_TIME</a>. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="a00466.html#ga3d0daf5d16bcb1b535a72dee69a2790f">BATIMP_WAIT_TIME</a> </dd></dl>
<dl class="section return"><dt>Returns</dt><dd><ul>
<li>If a negative number is returned, BOD was never triggered, indicating a low battery impedance.</li>
<li>Else, BOD was triggered. The value indicates the extra current that was drawn when BOD was triggered. </li>
</ul>
</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This check has a (small) negative impact on the battery. And, this check potentially can cause a reset. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 20 2020 08:24:34 for NHS31xx SW API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
