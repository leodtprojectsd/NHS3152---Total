<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NHS31xx SW API: SW Clock Restrictions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="nxp-logo_small.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NHS31xx SW API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a00767.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SW Clock Restrictions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are different clock constraints that can make it unwieldy to know the optimal system clock frequency at any moment during an application's lifetime. All constraints have been grouped here, with references to the respective modules they originate from.</p>
<h1><a class="anchor" id="clockrestrictions_minimumclockspeeds"></a>
Minimum clock speeds</h1>
<p>The table below lists what is possible, given a system clock frequency:</p><ul>
<li>The <em>Flash</em> <em>read</em> column indicates whether it can be readily read in LPM. The word <em>possible</em> indicates either the LPM mode must be switched off - see <a class="el" href="a00451.html#gacae6dfe817bf6354feb90656a578ae8d">Chip_Flash_SetHighPowerMode</a>, or wait states must be used<ul>
<li>see <a class="el" href="a00451.html#gab33d41bc84dc1175a6454d6dc994d9e5">Chip_Flash_SetNumWaitStates</a>.</li>
</ul>
</li>
<li>The <em>Flash</em> <em>erase/program</em> column indicates whether it can read flash sectors. Note that an erase/program action always requires the LPM mode to be switched off - this is taken care of automatically in the IAP library.</li>
<li>The <em>EEPROM</em> <em>write</em> column indicates whether the EPROM can be written to. For reading there are no clock restrictions.</li>
<li>The <em>I2C</em> columns denote whether fast and/or normal modes are possible.</li>
<li>The <em>SPI</em> columns denote the maximum supported data bitrate. However, it is not possible to configure the SPI clock to operate at any desired bitrate less than that maximum, as the API functions <a class="el" href="a00460.html#ga88fe00cb4dacaae29f067297b1eca936">Chip_SSP_SetBitRate</a> and <a class="el" href="a00460.html#gafec5ff2fa65168d944fe7de903e29f97">Chip_SSP_SetClockRate</a> only allow for a coarse granulation (as do the underlying SSP registers). See the section below, <a class="el" href="a00767.html#clockrestrictions_spibitrate">SPI bitrate selection</a> for a detailed overview to achieve bitrates as close as possible to two commonly used bitrates.</li>
</ul>
<p><a class="anchor" id="clockrestrictions_anchor_table"></a></p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight" colspan="2"><b>SysClock</b>  </th><th class="markdownTableHeadCenter">Flash read  </th><th class="markdownTableHeadCenter">Flash <br />
 erase/program  </th><th class="markdownTableHeadCenter">EEPROM <br />
 write  </th><th class="markdownTableHeadCenter">I2C master  </th><th class="markdownTableHeadCenter">I2C slave  </th><th class="markdownTableHeadRight">SPI Master  </th><th class="markdownTableHeadRight">SPI Slave   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" colspan="2"><b>8</b> MHz  </td><td class="markdownTableBodyCenter">possible  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">400 kbps  </td><td class="markdownTableBodyCenter">400 kbps  </td><td class="markdownTableBodyRight">4000 kbps  </td><td class="markdownTableBodyRight">667 kbps   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight" colspan="2"><b>4</b> MHz  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">400 kbps  </td><td class="markdownTableBodyCenter">100 kbps  </td><td class="markdownTableBodyRight">2000 kbps  </td><td class="markdownTableBodyRight">333 kbps   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" colspan="2"><b>2</b> MHz  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">100 kbps  </td><td class="markdownTableBodyCenter">100 kbps  </td><td class="markdownTableBodyRight">1000 kbps  </td><td class="markdownTableBodyRight">166 kbps   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight" colspan="2"><b>1</b> MHz  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">100 kbps  </td><td class="markdownTableBodyCenter">100 kbps  </td><td class="markdownTableBodyRight">500 kbps  </td><td class="markdownTableBodyRight">83 kbps   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" colspan="2"><b>500</b> kHz  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyRight">250 kbps  </td><td class="markdownTableBodyRight">41 kbps   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight" colspan="2"><b>250</b> kHz  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyRight">125 kbps  </td><td class="markdownTableBodyRight">20 kbps   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" colspan="2"><b>125</b> kHz  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyRight">62 kbps  </td><td class="markdownTableBodyRight">10 kbps   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight" colspan="2"><b>62.5</b> kHz  </td><td class="markdownTableBodyCenter">yes  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyCenter">no  </td><td class="markdownTableBodyRight">31 kbps  </td><td class="markdownTableBodyRight">5 kbps   </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The system clock frequency can be set in <a class="el" href="a00434.html">clock: Clock driver</a>, function <a class="el" href="a00434.html#ga8de42eae27a7e7c300f1f57da9e56bb2">Chip_Clock_System_SetClockFreq</a>.</li>
<li>The Low Power Mode of the Flash can be enabled and disabled in <a class="el" href="a00451.html">flash: Flash driver</a>, function <a class="el" href="a00451.html#gacae6dfe817bf6354feb90656a578ae8d">Chip_Flash_SetHighPowerMode</a>.</li>
<li>The EEPROM has no settings to tweak given a system clock frequency: the EEPROM initialization function will automatically set the best divider. See <a class="el" href="a00450.html">eeprom: EEPROM driver</a>, function <a class="el" href="a00450.html#ga65e67bfd12e5b091f3eb1978d16eeae1">Chip_EEPROM_Init</a>.</li>
<li>The data rate of the I2C can be set in <a class="el" href="a00453.html">i2c: I2C driver</a>, function <a class="el" href="a00453.html#ga17fac5d72058db8eed11d247e78b74ed">Chip_I2C_SetClockRate</a>.</li>
<li>The throughput of the SPI Master can be set in <a class="el" href="a00460.html">ssp: Serial Peripheral Interface / Synchronous Serial Port controller</a>, function <a class="el" href="a00460.html#ga88fe00cb4dacaae29f067297b1eca936">Chip_SSP_SetBitRate</a> or <a class="el" href="a00460.html#gafec5ff2fa65168d944fe7de903e29f97">Chip_SSP_SetClockRate</a>.</li>
</ul>
</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>The HW blocks mentioned above use a reference clock that is derived from the system clock. Hence the various required minimum system clock frequencies. It also incurs that changing the system clock frequency must be done with care: changing the clock frequency while communicating over I2C or SPI can result in a SW hangup; changing it while programming the flash or eeprom can result in undetermined memory contents.</dd></dl>
<h1><a class="anchor" id="clockrestrictions_spibitrate"></a>
SPI bitrate selection</h1>
<p>The nearest possible values for each system clock for 2 commonly used bitrates ( 9600bps and 19200bps ) are given below:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadRight" colspan="2"><b>SysClock</b>  </th><th class="markdownTableHeadCenter" colspan="2">Bitrate near t   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" colspan="2"><b>8MHz</b>  </td><td class="markdownTableBodyCenter">9592  </td><td class="markdownTableBodyCenter">19231   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight" colspan="2"><b>4MHz</b>  </td><td class="markdownTableBodyCenter">9615  </td><td class="markdownTableBodyCenter">19231   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" colspan="2"><b>2MHz</b>  </td><td class="markdownTableBodyCenter">9615  </td><td class="markdownTableBodyCenter">19231   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight" colspan="2"><b>1MHz</b>  </td><td class="markdownTableBodyCenter">9615  </td><td class="markdownTableBodyCenter">19231   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" colspan="2"><b>500kHz</b>  </td><td class="markdownTableBodyCenter">9615  </td><td class="markdownTableBodyCenter">19231   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight" colspan="2"><b>250kHz</b>  </td><td class="markdownTableBodyCenter">9615  </td><td class="markdownTableBodyCenter">17857   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyRight" colspan="2"><b>125kHz</b>  </td><td class="markdownTableBodyCenter">8929  </td><td class="markdownTableBodyCenter">20833   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyRight" colspan="2"><b>62.5kHz</b>  </td><td class="markdownTableBodyCenter">10417  </td><td class="markdownTableBodyCenter">15625   </td></tr>
</table>
<p>As an example: at 500kHz, to get 19200bps, the closest possible value that can be set is 19231bps.</p>
<p>Take care when coding the SPI bitrate selection: this is done using the API <a class="el" href="a00460.html#ga88fe00cb4dacaae29f067297b1eca936">Chip_SSP_SetBitRate</a>, which first calculates a prescale divider to attain the closest possible bitrate <b>less than or equal to</b> the requested one, then uses <a class="el" href="a00460.html#gafec5ff2fa65168d944fe7de903e29f97">Chip_SSP_SetClockRate</a> to configure the underlying HW. Clockrate close to but higher than what was requested are <b>not</b> considered. If this is nonetheless desired, the solution is to request for a higher bitrate than what is ideal.</p>
<p>As an example: at 500kHz, to get the bitrate closest to 19200bps, you must use the value <code>19232</code> for the argument <code>bitrate</code> when calling <a class="el" href="a00460.html#ga88fe00cb4dacaae29f067297b1eca936">Chip_SSP_SetBitRate</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 20 2020 08:24:33 for NHS31xx SW API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
